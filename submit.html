---
layout: page
title: Submit
order: 5
skipheader: yes
permalink: /submit/
---

<style>
.form {
  max-width: 30rem;
}
.question {
  margin-bottom: 1rem;
  width: 100%;
}
.question label {
  display: block;
  width: 100%;
}
.question input[type="text"] {
  display: block;
  width: 100%;
}
.question .required::after {
  content: '*';
}
.form .note {
  margin: 2rem 0 2rem;
  background-color: rgba(255, 234, 167, 0.5);
  padding: 1rem;
  border-radius: 3px;
}
.yaml-output {
  white-space: pre;
  word-wrap: normal;
  overflow: auto;
  font-family: monospace;
  font-size: 0.9rem;
  padding: .5rem 1rem;
  border-radius: 3px;
  border: 1px solid black;
  background-color: white;
}

.submit-area {
  max-width: 30rem;
}
summary {
  margin-bottom: 1rem;
}

.month {
  display: inline-block;
  padding-right: 1rem;
  padding-bottom: .5rem;
}
.month-label {
  text-align: center;
}
.calendar-month {
  display: inline-grid;
  grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
}
.calendar-month .day {
  text-align: center;
  background-color: white;
  border: 1px solid lightgrey;
  margin-right: -1px;
  margin-bottom: -1px;
  cursor: pointer;
  user-select: none;
  font-size: .8rem;
  padding: .2rem .25rem;
}
.calendar-month .day.today {
  background-color: #ffeaa7;
}
.calendar-month .day.selected {
  background-color: #0984e3;
  color: white;
}
.calendar-month .day.empty {
  border-width: 0;
}
</style>

<script src="{{ site.baseurl }}/assets/js-yaml.min.js"></script>


<div class="form">
  <div class="question">
    <label class="required">Event name</label>
    <input type="text" id="event-name" autofocus>
  </div>

  <div class="question">
    <label class="required">URL</label>
    <input type="text" id="event-url" placeholder="www.myevent.com">
  </div>

  <details>
    <summary>Additional information (optional, but helpful)</summary>

    <div class="question">
      <label>City</label>
      <input type="text" id="event-location">
    </div>

    <div class="question">
      <label>Part of (i.e. Festival Name/Business Name)</label>
      <input type="text" id="event-partof">
    </div>

    <div class="question">
      <label>Minimum age</label>
      <input type="text" id="event-minage">
    </div>

    <div class="question">
      <label>Price</label>
      <label><input type="radio" value="free" id="price-radio-free" name="price-radio"> FREE</label>
      <label><input type="radio" value="vendors" id="price-radio-vendors" name="price-radio"> FREE + Vendors</label>
      <label><input type="radio" value="range" id="price-radio-range" name="price-radio"> $<input type="number" size="4" id="event-price-minprice"/> - $<input type="number" size="4" id="event-price-maxprice"/></label>
    </div>

    <div class="question">
      <label>Tags</label>
      <label><input type="checkbox" data-type="tag" value="outdoor" id="event-tag-outdoor"> outdoor</label>
      <label><input type="checkbox" data-type="tag" value="indoor" id="event-tag-indoor"> indoor</label>
      <label><input type="checkbox" data-type="tag" value="sitting" id="event-tag-sitting"> sitting</label>
      <label><input type="checkbox" data-type="tag" value="active" id="event-tag-active"> active</label>
      <label><input type="checkbox" data-type="tag" value="baby-friendly" id="event-tag-baby-friendly"> baby-friendly</label>
      <label><input type="checkbox" data-type="tag" value="theater" id="event-tag-theater"> theater</label>
      <label><input type="checkbox" data-type="tag" value="sport" id="event-tag-sport"> sport</label>
    </div>

    <div class="question">
      <label>When</label>
      <label><input type="radio" value="ongoing" id="when-ongoing-radio" name="when-radio"> Ongoing</label>
      <label><input type="radio" value="freeform" id="when-freeform-radio" name="when-radio"> <input placeholder="e.g. every 3rd Tuesday" id="when-freeform" /></label>
      <label><input type="radio" value="specific" name="when-radio"> Choose dates:</label>

      <div id="calendar-picker">
      </div>
    </div>

  </details>

  <div class="note">
    <ol>
      <li><a href="#" class="mailto-link" target="_blank">Submit</a>, or</li>
      <li>Copy and paste the following into an email to haggardii+uv@gmail.com
        <div class="yaml-output"></div>
      </li>
    </ol>
  </div>
</div>


<script>
const towatch = Array.from(document.querySelectorAll('input'));
towatch.forEach(elem => {
  elem.addEventListener('change', ev => {
    refreshYAMLOutput();
  })
})

function recomputeYAML() {
  let base = {
    name: document.getElementById('event-name').value,
    url: document.getElementById('event-url').value,
    location: document.getElementById('event-location').value,
    partof: document.getElementById('event-partof').value || null,
    minage: document.getElementById('event-minage').value || null,
    when: null,
  }
  // tags
  base.tags = Array.from(document.querySelectorAll('input[data-type="tag"]'))
  .filter(tag_el => {
    return tag_el.checked;
  })
  .map(tag_el => {
    return tag_el.value;
  })

  // price
  if (document.getElementById('price-radio-free').checked) {
    base.price = 'free'
  } else if (document.getElementById('price-radio-vendors').checked) {
    base.price = 'vendors'
  } else {
    const minprice = Number(document.getElementById('event-price-minprice').value);
    const maxprice = Number(document.getElementById('event-price-maxprice').value);
    if (minprice || maxprice) {
      if (minprice === maxprice || minprice && !maxprice) {
        base.price = minprice;
      } else {
        base.price = [minprice, maxprice];
      }
    } else {
      base.price = '?'
    }
  }

  // when
  let selected_dates = Array.from(document.querySelectorAll('.day.selected'));
  if (document.getElementById('when-ongoing-radio').checked) {
    base.when = 'ongoing';
  } else if (document.getElementById('when-freeform-radio').checked) {
    base.when = document.getElementById('when-freeform').value;
  } else if (selected_dates.length) {
    // specific dates
    base.when = selected_dates.map(elem => {
      return elem.getAttribute('data-date');
    })
  }
  return [base]
}
function refreshYAMLOutput() {
  let val = recomputeYAML();
  const dumped = jsyaml.dump(val);
  Array.from(document.getElementsByClassName('yaml-output'))
  .forEach(elem => {
    elem.innerText = dumped;
  });
  Array.from(document.getElementsByClassName('mailto-link'))
  .forEach(elem => {
    elem.setAttribute('href', `mailto:haggardii+uv@gmail.com?subject=${encodeURIComponent('New Event - ' + val[0].name)}&body=${encodeURIComponent(dumped)}`);
  });
}


function createCalendar(root) {
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();
  for (var m = month; m < month+12; m++) {
    const p = new Date(year, m, 1);

    const m_elem = document.createElement('div');
    m_elem.classList.add('month');
    root.appendChild(m_elem);

    const mlabel_elem = document.createElement('div');
    mlabel_elem.classList.add('month-label');
    mlabel = p.getMonth() === 0 || m === month
      ? p.toLocaleString(navigator.language, {month: 'short', year: 'numeric'})
      : p.toLocaleString(navigator.language, {month: 'short'})
    mlabel_elem.innerHTML = mlabel;
    m_elem.appendChild(mlabel_elem);

    const mdates = document.createElement('div');
    mdates.classList.add('calendar-month');
    m_elem.appendChild(mdates);

    // XXX Pad before
    for (var i = 0; i < p.getDay(); i++) {
      const day = document.createElement('div');
      day.classList.add('day');
      day.classList.add('empty');
      mdates.appendChild(day);
    }

    while (p.getMonth() === (m%12)) {
      const day = document.createElement('div');
      day.classList.add('day');
      day.setAttribute('data-date', p.toISOString().substr(0, 10));
      day.innerHTML = p.getDate();
      mdates.appendChild(day);

      if (p.toDateString() === now.toDateString()) {
        day.classList.add('today');
      }

      day.addEventListener('click', ev => {
        if (day.classList.contains('selected')) {
          day.classList.remove('selected');
        } else {
          day.classList.add('selected');
        }
        refreshYAMLOutput();
      }, false)

      p.setDate(p.getDate() + 1);
    }
  }
}


function start() {
  console.log('start');
  createCalendar(document.getElementById('calendar-picker'));
  refreshYAMLOutput();
}
window.addEventListener('load', function() {
  start();
}, false)
</script>